<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apology</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            font-family: Arial, sans-serif;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            touch-action: none; /* Prevent scrolling on mobile */
        }
        #container {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #000, #001122);
        }
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
            pointer-events: none;
        }
        .crack {
            position: absolute;
            stroke: rgba(255,255,255,0.3);
            stroke-width: 2;
            fill: none;
            opacity: 0;
        }
        .letter {
            position: absolute;
            font-size: 80px;
            font-weight: bold;
            color: rgba(255,255,255,0.9);
            text-shadow: 0 0 20px rgba(255,255,255,0.8);
            opacity: 0;
            transform: scale(0);
        }
        .handwritten {
            font-family: 'Brush Script MT', cursive; /* Simulates handwritten */
        }
        .dust {
            background: rgba(200,200,200,0.8);
            box-shadow: 0 0 5px rgba(200,200,200,0.5);
        }
        .vein {
            background: radial-gradient(circle, rgba(255,0,0,0.8) 0%, rgba(255,0,0,0) 70%);
            box-shadow: 0 0 10px rgba(255,0,0,0.5);
        }
        .spark {
            width: 2px;
            height: 2px;
            background: rgba(255,255,255,1);
            box-shadow: 0 0 5px rgba(255,255,255,1);
        }
        #tap-text {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            opacity: 0;
            pointer-events: none;
        }
        #hold-button {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.5);
            border-radius: 20px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            opacity: 0;
            pointer-events: none;
        }
        audio {
            display: none;
        }
    </style>
</head>
<body>
    <div id="container">
        <svg width="100%" height="100%" id="cracks"></svg>
        <div id="particles"></div>
        <div id="letters"></div>
        <div id="tap-text">Tap the screen</div>
        <button id="hold-button">Hold to feel it</button>
        <audio id="heartbeat" loop>
            <source src="heartbeat.mp3" type="audio/mpeg"> <!-- Placeholder: Download free heartbeat sound from freesound.org -->
        </audio>
        <audio id="whisper">
            <source src="whisper.mp3" type="audio/mpeg"> <!-- Placeholder: Record or download free whisper -->
        </audio>
        <audio id="breathing" loop>
            <source src="breathing.mp3" type="audio/mpeg"> <!-- Placeholder: Download free breathing sound -->
        </audio>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script> <!-- GSAP for animations -->
    <script>
        // Global variables
        const container = document.getElementById('container');
        const particlesDiv = document.getElementById('particles');
        const lettersDiv = document.getElementById('letters');
        const cracksSvg = document.getElementById('cracks');
        const tapText = document.getElementById('tap-text');
        const holdButton = document.getElementById('hold-button');
        const heartbeatAudio = document.getElementById('heartbeat');
        const whisperAudio = document.getElementById('whisper');
        const breathingAudio = document.getElementById('breathing');

        let particles = [];
        let cracks = [];
        let scene = 0; // 0: init, 1: sorry, 2: transform, 3: iloveyou
        let tl = gsap.timeline(); // Main timeline for sequencing

        // Letter positions (simplified coordinates for "SORRY" and "I LOVE YOU")
        const sorryPositions = [
            // S: array of [x,y] for particles
            [[50,50],[55,45],[60,40],[65,45],[70,50],[65,55],[60,60],[55,65],[50,70],[45,65]],
            // O: [[...]]
            [[100,50],[105,45],[110,40],[115,45],[120,50],[125,55],[120,60],[115,65],[110,70],[105,65]],
            // R: [[...]]
            [[150,50],[155,45],[160,40],[165,45],[170,50],[165,55],[160,60],[155,65],[150,70],[145,65]],
            // R: [[...]]
            [[200,50],[205,45],[210,40],[215,45],[220,50],[215,55],[210,60],[205,65],[200,70],[195,65]],
            // Y: [[...]]
            [[250,50],[255,45],[260,40],[265,45],[270,50],[265,55],[260,60],[255,65],[250,70],[245,65]]
        ];
        const iloveyouPositions = [
            // I: [[...]]
            [[50,200],[55,195],[60,190],[65,195],[70,200],[65,205],[60,210],[55,215],[50,220],[45,215]],
            // L: [[...]]
            [[100,200],[105,195],[110,190],[115,195],[120,200],[125,205],[120,210],[115,215],[110,220],[105,215]],
            // O: [[...]]
            [[150,200],[155,195],[160,190],[165,195],[170,200],[175,205],[170,210],[165,215],[160,220],[155,215]],
            // V: [[...]]
            [[200,200],[205,195],[210,190],[215,195],[220,200],[225,205],[220,210],[215,215],[210,220],[205,215]],
            // E: [[...]]
            [[250,200],[255,195],[260,190],[265,195],[270,200],[275,205],[270,210],[265,215],[260,220],[255,215]],
            // Y: [[...]]
            [[300,200],[305,195],[310,190],[315,195],[320,200],[325,205],[320,210],[315,215],[310,220],[305,215]],
            // O: [[...]]
            [[350,200],[355,195],[360,190],[365,195],[370,200],[375,205],[370,210],[365,215],[360,220],[355,215]],
            // U: [[...]]
            [[400,200],[405,195],[410,190],[415,195],[420,200],[425,205],[420,210],[415,215],[410,220],[405,215]]
        ];

        // Initialize particles (100 for letters, more for dust/sparks)
        function createParticles(count, className) {
            for (let i = 0; i < count; i++) {
                const p = document.createElement('div');
                p.className = `particle ${className}`;
                p.style.left = Math.random() * 100 + 'vw';
                p.style.top = Math.random() * 100 + 'vh';
                particlesDiv.appendChild(p);
                particles.push(p);
            }
        }

        // Create cracks (simple lines)
        function createCracks() {
            for (let i = 0; i < 5; i++) { // 5 cracks for "SORRY"
                const crack = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                crack.className = 'crack';
                crack.setAttribute('d', `M${Math.random()*100} ${Math.random()*100} L${Math.random()*100} ${Math.random()*100}`);
                cracksSvg.appendChild(crack);
                cracks.push(crack);
            }
        }

        // Start scene 1: Heartbeat, cracks, form "SORRY"
        function startScene1() {
            heartbeatAudio.volume = 0.3;
            heartbeatAudio.play();
            tl.to(cracks[0], {opacity: 1, scale: 1.1, duration: 1, ease: "power2.inOut"}, 0);
            tl.to(cracks[1], {opacity: 1, scale: 1.1, duration: 1, ease: "power2.inOut"}, 1);
            tl.to(cracks[2], {opacity: 1, scale: 1.1, duration: 1, ease: "power2.inOut"}, 2);
            tl.to(cracks[3], {opacity: 1, scale: 1.1, duration: 1, ease: "power2.inOut"}, 3);
            tl.to(cracks[4], {opacity: 1, scale: 1.1, duration: 1, ease: "power2.inOut"}, 4);
            // Animate particles to form "SORRY" with shake for regret
            sorryPositions.forEach((letter, idx) => {
                letter.forEach((pos, pidx) => {
                    const p = particles[idx * 10 + pidx];
                    tl.to(p, {x: pos[0], y: pos[1], duration: 0.5, ease: "elastic.out(1, 0.3)"}, idx * 1 + 0.5);
                    tl.to(p, {scale: 1.2, duration: 0.1, yoyo: true, repeat: 3, ease: "power2.inOut"}, idx * 1 + 1); // Shake
                });
            });
            tl.to(tapText, {opacity: 1, duration: 1}, 5);
            // On tap, reverse dust fall
            container.addEventListener('touchstart', handleTap, {once: true});
        }

        function handleTap() {
            // Collapse letters to dust and fall
            particles.forEach(p => {
                p.classList.add('dust');
                gsap.to(p, {y: '+=100vh', duration: 2, ease: "power2.inOut", onComplete: () => {
                    whisperAudio.volume = 0.2;
                    whisperAudio.play();
                }});
            });
            gsap.to(tapText, {opacity: 0, duration: 1});
            // Reverse on tap
            setTimeout(() => {
                particles.forEach(p => gsap.to(p, {y: '-=100vh', duration: 2, ease: "power2.inOut", onComplete: startScene2}));
            }, 2000);
        }

        // Scene 2: Transform to veins, background shift, breathing
        function startScene2() {
            heartbeatAudio.pause();
            breathingAudio.volume = 0.3;
            breathingAudio.play();
            particles.forEach(p => {
                p.classList.remove('dust');
                p.classList.add('vein');
                gsap.to(p, {background: 'radial-gradient(circle, rgba(255,0,0,0.8) 0%, rgba(255,0,0,0) 70%)', duration: 1});
            });
            gsap.to(container, {background: 'linear-gradient(to bottom, #ff7e5f, #feb47b)', duration: 3, ease: "slow(0.7, 0.7, false)"}); // Sunset
            setTimeout(startScene3, 3000);
        }

        // Scene 3: Form "I LOVE YOU", pulses, sparks
        function startScene3() {
            // Animate to new positions
            iloveyouPositions.forEach((letter, idx) => {
                letter.forEach((pos, pidx) => {
                    const p = particles[idx * 10 + pidx];
                    gsap.to(p, {x: pos[0], y: pos[1], duration: 1, ease: "power2.inOut"});
                });
                // Pulse each letter
                gsap.to(particles.slice(idx*10, (idx+1)*10), {scale: 1.5, duration: 0.5, yoyo: true, ease: "power2.inOut"}, idx * 0.5);
            });
            // Add sparks
            createParticles(50, 'spark');
            particles.slice(-50).forEach(p => {
                gsap.to(p, {y: '-=100vh', duration: 5, repeat: -1, ease: "slow(0.7, 0.7, false)"});
            });
            gsap.to(holdButton, {opacity: 1, pointerEvents: 'auto', duration: 1});
            // Long press
            holdButton.addEventListener('touchstart', handleHold);
            holdButton.addEventListener('touchend', handleRelease);
        }

        function handleHold() {
            gsap.to(particles, {scale: 1.8, duration: 0.5, ease: "power2.inOut"});
            gsap.to(container, {background: 'linear-gradient(to bottom, #fff, #ffeaa7)', duration: 1});
        }

        function handleRelease() {
            gsap.to(particles, {scale: 1, duration: 0.5, ease: "power2.inOut"});
            gsap.to(container, {background: 'linear-gradient(to bottom, #ff7e5f, #feb47b)', duration: 1});
        }

        // Init
        createParticles(50, ''); // For SORRY
        createCracks();
        startScene1();
    </script>
</body>
</html>